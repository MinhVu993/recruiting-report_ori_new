<i18n>
    {
        "en": {
            "Personal Information": "Personal Information",
            "Name": "Full name",
            "Gender:": "Gender:",
            "Birth day": "Birth day",
            "ID Number": "ID Number",
            "ID Issue Date": "ID Card issue date",
            "Phone Number": "Phone Number",
            "Place residence address": "Place residence address",
            "Alternative Phone Number": "Alternative Phone Number",
            "Alternative Address": "Alternative Address",
            "Demand information": "Demand information",
            "Demand ID": "Demand ID",
            "Sub position": "Sub position",
            "Select Demand": "Select Demand",
            "Recruiting Information": "Recruiting Information",
            "Position": "Position",
            "Department": "Department",
            "Recruitment Source": "Recruitment Source",
            "CV Received Date": "CV Received Date",
            "Salary Sign Date": "Salary Sign Date",
            "Worked at VG": "Worked at VG",
            "HR Interview Date": "HR Interview Date",
            "HR Review Date": "HR Review Date",
            "Dept Interview Date": "Department interview date",
            "Dept Review Date": "Dept Review Date",
            "Expected On board": "Expected On board",
            "On board": "On board",
            "HR Accept": "HR Accept",
            "Dept Accept": "Dept Accept",
            "Started Working": "Started Working",
            "Recruited by Bus": "Recruited by Bus",
            "Regist Bus Company": "Regist Bus Company",
            "Old Employee No": "Old Employee No",
            "Previous Company": "Previous Company",
            "Note": "Note",
            "HR reject reason": "HR reject reason",
            "Graduate School": "Graduate School",
            "Change Start Date": "Change Start Date",
            "Country Code": "Country Code",
            "Nationality Code": "Nationality Code",
            "Empno HRM": "Empno HRM",
            "HRM Dep.": "HRM Dep.",
            "Trial Period": "Trial Period",
            "Select Parameter": "Select Parameter",
            "Select Ethnicity": "Select Ethnicity",
            "Select Rank": "Select Rank",
            "Job Level": "Job Level",
            "Factory Code": "Factory Code",
            "Work Area": "Work Area",
            "D/I": "D/I",
            "Marital Status": "Marital Status",
            "Education": "Education",
            "Birth Province": "Birth Province",
            "Province": "Province",
            "Bus Company": "Bus Company",
            "Source recruiting": "Source recruiting",
            "Recruitment Source (VI)": "Recruitment Source (VI)",
            "Recruitment Source (EN)": "Recruitment Source (EN)",
            "Recruitment Source (CN)": "Recruitment Source (CN)",
            "Save": "SAVE",
            "CLOSE": "CLOSE",
            "Rows per page": "Rows per page",
            "Male": "Male",
            "Female":"Female",
            "Please enter your ID number to check information.": "Please enter your ID number to check information.",
            "Reset": "Reset",
            "Submit": "Submit",
            "Name is required": "Name is required",
            "Do you want to delete the candidate?": "Do you want to delete the candidate?",
            "OK": "OK",
            "Cancel": "Cancel",
            "Warning": "Warning",
            "Select": "Select",
            "Department": "Department",
            "Position": "Position",
            "Sub position": "Sub position",
            "Quantity": "Quantity",
            "Hired": "Hired",
            "Stock number": "Stock number",
            "Input date": "Input date",
            "Content": "Content",
            "Note": "Note",
            "Action": "Actions",
            "Demand": "Demand",
            "Unit": "Unit",
            "Work Experience": "Work Experience",
            "Ex Company": "Ex Company",
            "Ex Position": "Ex Position",
            "Candidate reject reason": "Candidate reject reason",
            "Department reject reason ": "Department reject reason ",
            "Change on board": "Change on board",
            "Category ID": "Category ID",
            "View resignation history": "View resignation history",
            "Select recruitment Source": "Select recruitment Source",
            "Empno": "Empno",
            "Dept": "Dept",
            "Seniority": "Seniority",
            "In date": "In date",
            "Resign date": "Resign date",
            "Reason": "Reason",
            "Emp No. HRM": "Emp No. HRM",
            "Work Experience part time": "Work Experience part time",
            "Email adress": "Email address",
            "Select Religious": "Select Religious"
        },
        "vi": {
            "Personal Information": "Thông tin cá nhân",
            "Name": "Họ tên",
            "Gender:": "Giới tính:",
            "Birth day": "Ngày sinh",
            "ID Number": "Số CCCD",
            "ID Issue Date": "Ngày cấp CCCD",
            "Phone Number": "Số điện thoại",
            "Place residence address": "Địa chỉ cư trú",
            "Alternative Phone Number": "Số điện thoại thay thế",
            "Alternative Address": "Địa chỉ khác",
            "Demand information": "Thông tin nhu cầu",
            "Demand ID": "Mã nhu cầu",
            "Sub position": "Vị trí phụ",
            "Select Demand": "Chọn nhu cầu",
            "Recruiting Information": "Thông tin tuyển dụng",
            "Position": "Vị trí",
            "Department": "Bộ phận",
            "Recruitment Source": "Nguồn tuyển dụng",
            "CV Received Date": "Ngày nhận CV",
            "Salary Sign Date": "Ngày ký lương",
            "Worked at VG": "Đã làm việc ở VG",
            "HR Interview Date": "Ngày HR phỏng vấn",
            "HR Review Date": "Ngày HR xét duyệt",
            "Dept Interview Date": "Ngày BP phỏng vấn",
            "Dept Review Date": "Ngày BP xét duyệt",
            "Expected On board": "Ngày vào làm",
            "On board": "Ngày thực tế vào làm",
            "HR Accept": "HR chấp nhận",
            "Dept Accept": "BP chấp nhận",
            "Started Working": "Đã vào làm",
            "Recruited by Bus": "Tuyển dụng bởi nhà xe",
            "Regist Bus Company": "Đăng ký nhà xe",
            "Old Employee No": "Mã nhân viên cũ",
            "Previous Company": "Công ty trở về",
            "Note": "Ghi chú",
            "HR reject reason": "Lý do từ chối của HR",
            "Graduate School": "Trường tốt nghiệp",
            "Change Start Date": "Đổi ngày nhận việc",
            "Country Code": "Mã quốc gia",
            "Nationality Code": "Mã quốc tịch",
            "Empno HRM": "Mã nhân viên HRM",
            "HRM Dep.": "Bộ phận HRM",
            "Trial Period": "Thời gian thử việc",
            "Select Parameter": "Chọn tham số",
            "Select Ethnicity": "Chọn dân tộc",
            "Select Rank": "Chọn cấp bậc",
            "Job Level": "Cấp độ công việc",
            "Factory Code": "Mã nhà máy",
            "Work Area": "Khu vực làm việc",
            "D/I": "D/I",
            "Marital Status": "Tình trạng hôn nhân",
            "Education": "Trình độ học vấn",
            "Birth Province": "Tỉnh/TP sinh",
            "Province": "Tỉnh/TP",
            "Bus Company": "Nhà xe",
            "Source recruiting": "Nguồn tuyển dụng",
            "Recruitment Source (VI)": "Nguồn tuyển dụng (VI)",
            "Recruitment Source (EN)": "Nguồn tuyển dụng (EN)",
            "Recruitment Source (CN)": "Nguồn tuyển dụng (CN)",
            "Save": "LƯU",
            "CLOSE": "ĐÓNG",
            "Rows per page": "Số dòng trên trang",
            "Male": "Nam",
            "Female":"Nữ",
            "Please enter your ID number to check information.": "Vui lòng nhập số CCCD để tiếp tục kiểm tra thông tin",
            "Reset": "Làm mới",
            "Submit": "Gửi",
            "Name is required": "Vui lòng nhập họ tên",
            "Do you want to delete the candidate?": "Bạn có muốn xóa ứng viên này không?",
            "OK": "Đồng ý",
            "Cancel": "Hủy",
            "Warning": "Cảnh báo",
            "Select": "Chọn",
            "Department": "Bộ phận",
            "Position": "Vị trí",
            "Sub position": "Vị trí phụ",
            "Quantity": "Số lượng",
            "Hired": "Đã tuyển",
            "Stock number": "Số lượng còn thiếu",
            "Input date": "Ngày nhập",
            "Content": "Nội dung",
            "Note": "Ghi chú",
            "Action": "Hành động",
            "Demand": "Nhu cầu",
            "Unit": "Đơn vị",
            "Work Experience": "Kinh nghiệm làm việc",
            "Ex Company": "Công ty đã làm việc",
            "Ex Position": "Vị trí đã làm việc",
            "Candidate reject reason": "Lý do từ chối ứng viên",
            "Department reject reason ": "Lý do bộ phận từ chối ",
            "Change on board": "Thay đổi ngày vào làm",
            "Category ID": "Mã loại",
            "View resignation history": "Xem lịch sử nghỉ việc",
            "Select recruitment Source": "Chọn nguồn tuyển dụng",
            "Empno": "MST",
            "Dept": "Bộ phận",
            "Seniority": "Thâm niên",
            "In date": "Ngày vào",
            "Resign date": "Ngày thôi việc",
            "Reason": "Lý do",
            "Emp No. HRM": "Mã nhân viên HRM",
            "Work Experience part time": "Kinh nghiệm làm việc bán thời gian",
            "Email adress": "Địa chỉ email",
            "Select Religious": "Chọn tôn giáo"
        },
        "cn": {
            "Personal Information": "个人信息",
            "Name": "姓名",
            "Gender:": "性别:",
            "Birth day": "出生日期",
            "ID Number": "身份证号",
            "ID Issue Date": "身份证发行日期",
            "Phone Number": "电话号码",
            "Place residence address": "居住地址",
            "Alternative Phone Number": "备用电话号码",
            "Alternative Address": "备用地址",
            "Demand information": "需求信息",
            "Demand ID": "需求编号",
            "Sub position": "副职位",
            "Select Demand": "选择需求",
            "Recruiting Information": "招聘信息",
            "Position": "职位",
            "Department": "部门",
            "Recruitment Source": "招聘来源",
            "CV Received Date": "简历接收日期",
            "Salary Sign Date": "薪资签订日期",
            "Worked at VG": "在VG工作过",
            "HR Interview Date": "人事面试日期",
            "HR Review Date": "人事审核日期",
            "Dept Interview Date": "部门面试日期", 
            "Dept Review Date": "部门审核日期",
            "Expected On board": "预计入职日期",
            "On board": "入职日期",
            "HR Accept": "人事接受",
            "Dept Accept": "部门接受",
            "Started Working": "已入职",
            "Recruited by Bus": "班车招聘",
            "Regist Bus Company": "注册班车公司",
            "Old Employee No": "原工号",
            "Previous Company": "原公司",
            "Note": "备注",
            "HR reject reason": "人事拒绝原因",
            "Graduate School": "毕业学校",
            "Change Start Date": "更改入职日期",
            "Country Code": "国家代码",
            "Nationality Code": "国籍代码", 
            "Empno HRM": "HRM工号",
            "HRM Dep.": "HRM部门",
            "Trial Period": "试用期",
            "Select Parameter": "选择参数",
            "Select Ethnicity": "选择民族",
            "Select Rank": "选择职级",
            "Job Level": "职位等级",
            "Factory Code": "工厂代码",
            "Work Area": "工作区域",
            "D/I": "D/I",
            "Marital Status": "婚姻状况",
            "Education": "教育程度",
            "Birth Province": "出生省份",
            "Province": "省份",
            "Bus Company": "班车公司",
            "Source recruiting": "招聘来源",
            "Recruitment Source (VI)": "招聘来源 (VI)",
            "Recruitment Source (EN)": "招聘来源 (EN)",
            "Recruitment Source (CN)": "招聘来源 (CN)",
            "Save": "保存",
            "CLOSE": "关闭",
            "Rows per page": "每页行数",
            "Male": "男",
            "Female":"女",
            "Please enter your ID number to check information.": "请输入您的身份证号以查看信息",
            "Reset": "重置",
            "Submit": "提交",
            "Name is required": "请输入姓名",
            "Do you want to delete the candidate?": "您是否要删除候选人？",
            "OK": "确定",
            "Cancel": "取消",
            "Warning": "警告",
            "Select": "选择",
            "Department": "部门",
            "Position": "职位",
            "Sub position": "副职位",
            "Quantity": "数量",
            "Hired": "已招聘",
            "Stock number": "库存数量",
            "Input date": "输入日期",
            "Content": "内容",
            "Note": "备注",
            "Action": "操作",
            "Demand": "需求",
            "Unit": "单位",
            "Work Experience": "工作经验",
            "Ex Company": "前公司",
            "Ex Position": "前职位",
            "Candidate reject reason": "候选人拒绝原因",
            "Department reject reason ": "部门拒绝原因",
            "Change on board": "更改入职日期",
            "Category ID": "类别 ID",
            "View resignation history": "查看辞职历史",
            "Select recruitment Source": "选择招聘来源",
            "Empno": "工号",
            "Dept": "部门",
            "Seniority": "工龄",
            "In date": "入职日期",
            "Resign date": "离职日期",
            "Reason": "原因",
            "Emp No. HRM": "HRM工号",
            "Work Experience part time": "兼职工作经验",
            "Email adress": "电子邮件地址",
            "Select Religious": "选择宗教"
        }
    }
</i18n>

<template>
    <v-app>
        <v-row align-content="start" dense>
            <!-- Personal Information Section -->
            <v-col cols="12">
                <v-card class="pa-4 mb-2" elevation="2">
                    <div class="section-header">
                        <v-icon color="primary" class="mr-2">mdi-account</v-icon>
                        <span class="text-h6">[{{ $t('Personal Information') }}]</span>
                        <span class="text-caption error--text ml-2">
                            <v-icon small color="error">mdi-alert</v-icon>
                            {{ $t('Please enter your ID number to check information.') }}
                        </span>
                    </div>
                    <!-- Basic Information -->
                    <v-row dense>
                        <v-col cols="2">
                            <div class="d-flex align-center">
                                <v-text-field v-model="cccd" :label="$t('ID Number')" outlined dense hide-details
                                @change="checkEmpno" maxlength="12" @input="validateCccd"
                                :rules="[rules.required, rules.number, rules.length]" class="mr-2"></v-text-field>
                                <v-icon color="teal" @click="checkEmpno">mdi-card-account-details</v-icon>
                            </div>
                        </v-col>
                        <v-col cols="2">
                            <v-text-field v-model="selectedDatecccd" :label="$t('ID Issue Date')" outlined dense
                            hide-details v-mask="'####-##-##'" prepend-inner-icon="mdi-calendar"
                            placeholder="YYYY-MM-DD"></v-text-field>
                        </v-col>
                        <v-col cols="4">
                            <v-text-field ref="nameField" v-model="name" :label="$t('Name')" outlined dense
                            :error-messages="nameError" :error="!!nameError" hide-details="auto"
                            @click="focusNameField" @input="validateName"></v-text-field>
                        </v-col>
                        <v-col cols="2">
                            <v-text-field v-model="dateBirth" :label="$t('Birth day')" outlined dense hide-details
                            v-mask="'####-##-##'" prepend-inner-icon="mdi-calendar"
                            placeholder="YYYY-MM-DD"></v-text-field>
                        </v-col>
                        <v-col cols="2">
                            <v-radio-group v-model="gender" row dense hide-details class="mt-0">
                                <label class="mr-2 grey--text">{{ $t('Gender:') }}</label>
                                <v-radio :label="$t('Male')" value="0" class="mr-2"></v-radio>
                                <v-radio :label="$t('Female')" value="1"></v-radio>
                            </v-radio-group>
                        </v-col>
                    </v-row>
                    <!-- Contact Information -->
                    <v-row dense class="mt-1">
                        <v-col cols="3">
                            <v-text-field v-model="address" :label="$t('Place residence address')" outlined dense
                            hide-details></v-text-field>
                        </v-col>
                        <v-col cols="3">
                            <v-text-field v-model="sub_address" :label="$t('Alternative Address')" outlined dense
                            hide-details></v-text-field>
                        </v-col>
                        <v-col cols="2">
                            <v-text-field v-model="tel" :label="$t('Phone Number')" outlined dense
                            hide-details></v-text-field>
                        </v-col>
                        
                        <v-col cols="2">
                            <v-text-field v-model="sub_tel" :label="$t('Alternative Phone Number')" outlined dense
                            hide-details></v-text-field>
                        </v-col>
                        <!-- email -->
                        <v-col cols="2">
                            <v-text-field v-model="email" :label="$t('Email adress')" outlined dense
                            hide-details></v-text-field>
                        </v-col>
                    </v-row>
                    
                    <v-row dense class="mt-1">
                        <v-col cols="2">
                            <v-combobox v-model="edu" :items="item_edu" :item-value="code" item-text="name"
                            :label="$t('Education')" dense outlined hide-details></v-combobox>
                        </v-col>
                        <v-col cols="2">
                            <v-textarea v-model="school_gra" :label="$t('Graduate School')" outlined dense auto-grow
                            rows="1" hide-details></v-textarea>
                        </v-col>
                        <v-col cols="2">
                            <v-text-field v-model="work_exp" :label="$t('Work Experience')" outlined dense
                            hide-details></v-text-field>
                        </v-col>
                        <v-col cols="2">
                            <v-text-field v-model="work_exp_pt" :label="$t('Work Experience part time')" outlined dense
                            hide-details></v-text-field>
                        </v-col>
                        <v-col cols="2">
                            <v-text-field v-model="ex_company" :label="$t('Ex Company')" outlined dense
                            hide-details></v-text-field>
                        </v-col>
                        <v-col cols="2">
                            <v-text-field v-model="ex_position" :label="$t('Ex Position')" outlined dense
                            hide-details></v-text-field>
                        </v-col>
                    </v-row>
                </v-card>
            </v-col>
            <v-col cols="12">
                <v-card class="pa-4 mb-2" elevation="2">
                    <div class="section-header">
                        <v-icon color="primary" class="mr-2">mdi-account</v-icon>
                        <span class="text-h6">[{{ $t('Demand information') }}]</span>
                    </div>
                    <v-row dense>
                        <v-col cols="2">
                            <v-combobox v-model="dept_apply" :items="item_dept_apply" item-text="deptName_temp"
                            return-object :label="$t('Department')" dense outlined hide-details>
                        </v-combobox>
                    </v-col>
                    <v-col cols="1" v-show="dept_apply">
                        <v-btn @click="getDataDemandByDept()" color="warning" dark>
                            <v-icon>mdi-plus</v-icon>
                            {{ $t('Select Demand') }}
                        </v-btn>
                    </v-col>
                    <v-col cols="1">
                        <v-text-field v-model="dm_id" :label="$t('Demand ID')" outlined dense disabled class="ml-3"
                        hide-details></v-text-field>
                    </v-col>
                    <v-col cols="1">
                        <v-combobox v-model="loc_apply" :items="item_loc_apply" :label="$t('Position')" dense
                        outlined hide-details clearable>
                    </v-combobox>
                </v-col>
                <v-col cols="2">
                    <v-text-field v-model="dm_Subpos" :label="$t('Sub position')" outlined dense
                    hide-details></v-text-field>
                </v-col>
            </v-row>
        </v-card>
    </v-col>
    <v-col cols="12">
        <v-card class="pa-4 mb-2" elevation="2">
            <div class="section-header">
                <v-icon color="primary" class="mr-2">mdi-briefcase</v-icon>
                <span class="text-h6">[{{ $t('Recruiting Information') }}]</span>
            </div>
            <v-row dense>
                <v-col cols="4">
                    <div style="display: flex; align-items: center;">
                        <v-combobox v-model="source_recruit" :items="item_source_recruit" :item-value="code"
                        :item-text="item => item.name[this.$i18n.locale]" :label="$t('Recruitment Source')"
                        dense outlined hide-details>
                    </v-combobox>
                    <v-tooltip bottom>
                        <template v-slot:activator="{ on, attrs }">
                            <v-btn @click="dialogSourceRecuiting = true" fab x-small color="error" dark
                            style="margin-left: 8px;" v-bind="attrs" v-on="on">
                            <v-icon>mdi-plus</v-icon>
                        </v-btn>
                    </template>
                    <span>{{ $t('Select recruitment Source') }}</span>
                </v-tooltip>
            </div>
        </v-col>
        <v-col cols="2">
            <v-combobox v-model="bus_info" :items="item_bus_info" :label="$t('Bus Company')" dense outlined
            hide-details>
        </v-combobox>
    </v-col>
    <v-col cols="2">
        <v-menu v-model="dateMenu" :close-on-content-click="true" transition="scale-transition">
            <template v-slot:activator="{ on, attrs }">
                <v-text-field v-model="date_cv" :label="$t('CV Received Date')" readonly
                v-bind="attrs" v-on="on" outlined dense hide-details
                prepend-inner-icon="mdi-calendar" clearable @click:clear="date_cv = null">
            </v-text-field>
        </template>
        <v-date-picker v-model="date_cv" @input="dateMenu = false" header-color="teal"
        :locale="$i18n.locale == 'cn' ? 'zh' : $i18n.locale">
    </v-date-picker>
</v-menu>
</v-col>
<v-col cols="2">
    <div class="d-flex align-center">
        <v-text-field v-model="inVG" :label="$t('Worked at VG')" outlined dense hide-details>
        </v-text-field>
        <v-tooltip bottom>
            <template v-slot:activator="{ on, attrs }">
                <v-btn fab x-small color="success" dark @click="showResignDialog"
                style="margin-left: 8px;" v-bind="attrs" v-on="on">
                <v-icon>mdi-history</v-icon>
            </v-btn>
        </template>
        <span>{{ $t('View resignation history') }}</span>
    </v-tooltip>
</div>
</v-col>
<v-col cols="2">
    <v-text-field v-model="empno_old" :label="$t('Old Employee No')" outlined dense
    hide-details>
</v-text-field>
</v-col>
</v-row>

<!-- Interview Process -->
<v-row dense class="mt-2">
    <v-col cols="2">
        <v-menu v-model="dateHR" :close-on-content-click="false" transition="scale-transition"
        offset-y>
        <template v-slot:activator="{ on, attrs }">
            <v-text-field v-model="date_hr_inter" :label="$t('HR Interview Date')" readonly
            v-bind="attrs" v-on="on" outlined dense hide-details
            prepend-inner-icon="mdi-calendar" clearable @click:clear="date_hr_inter = null">
        </v-text-field>
    </template>
    <v-date-picker v-model="date_hr_inter" @input="dateHR = false" header-color="teal"
    :locale="$i18n.locale == 'cn' ? 'zh' : $i18n.locale">
</v-date-picker>
</v-menu>
</v-col>
<v-col cols="2">
    <v-menu v-model="dateHRAcc" :close-on-content-click="false" transition="scale-transition"
    offset-y>
    <template v-slot:activator="{ on, attrs }">
        <v-text-field v-model="date_hr_review" :label="$t('HR Review Date')" readonly
        v-bind="attrs" v-on="on" outlined dense hide-details
        prepend-inner-icon="mdi-calendar" clearable
        @click:clear="date_hr_review = null">
    </v-text-field>
</template>
<v-date-picker v-model="date_hr_review" @input="dateHRAcc = false" header-color="teal"
:locale="$i18n.locale == 'cn' ? 'zh' : $i18n.locale">
</v-date-picker>
</v-menu>
</v-col>
<v-col cols="1">
    <v-checkbox v-model="hrAcc" :label="$t('HR Accept')" class="mt-1" color="red" value="yes"
    hide-details>
</v-checkbox>
</v-col>
<v-col cols="7">
    <v-textarea v-model="reason" :label="$t('HR reject reason')" outlined dense hide-details auto-grow
    rows="1">
</v-textarea>
</v-col>
</v-row>
<!-- Previous Employment -->
<v-row dense class="mt-2">
    <v-col cols="2">
        <v-combobox v-model="comp_return" :items="item_comp_return" :label="$t('Previous Company')"
        dense outlined hide-details>
    </v-combobox>
</v-col>
<v-col cols="10">
    <v-textarea v-model="remark" :label="$t('Note')" outlined dense hide-details rows="1" auto-grow>
    </v-textarea>
</v-col>
</v-row>
<!-- Department Review -->
<v-row dense class="mt-2">
    <v-col cols="2">
        <v-menu v-model="datedept" :close-on-content-click="false" transition="scale-transition"
        offset-y>
        <template v-slot:activator="{ on, attrs }">
            <v-text-field v-model="date_dept_inter" :label="$t('Dept Interview Date')" readonly
            v-bind="attrs" v-on="on" outlined dense hide-details
            prepend-inner-icon="mdi-calendar" clearable
            @click:clear="date_dept_inter = null">
        </v-text-field>
    </template>
    <v-date-picker v-model="date_dept_inter" @input="datedept = false" header-color="teal"
    :locale="$i18n.locale == 'cn' ? 'zh' : $i18n.locale">
</v-date-picker>
</v-menu>
</v-col>
<v-col cols="2">
    <v-menu v-model="datedeptAcc" :close-on-content-click="false" transition="scale-transition"
    offset-y>
    <template v-slot:activator="{ on, attrs }">
        <v-text-field v-model="date_dept_review" :label="$t('Dept Review Date')" readonly
        v-bind="attrs" v-on="on" outlined dense hide-details
        prepend-inner-icon="mdi-calendar" clearable
        @click:clear="date_dept_review = null">
    </v-text-field>
</template>
<v-date-picker v-model="date_dept_review" @input="datedeptAcc = false"
header-color="teal" :locale="$i18n.locale == 'cn' ? 'zh' : $i18n.locale">
</v-date-picker>
</v-menu>
</v-col>
<v-col cols="1">
    <v-checkbox v-model="deptACC" :label="$t('Dept Accept')" class="mt-1" color="red"
    value="yes" hide-details>
</v-checkbox>
</v-col>
<v-col cols="5">
    <v-textarea v-model="dept_reason" :label="$t('Department reject reason')" outlined dense auto-grow
    hide-details rows="1">
</v-textarea>
</v-col>
<v-col cols="2">
    <v-menu v-model="dateSalary" :close-on-content-click="false" transition="scale-transition">
        <template v-slot:activator="{ on, attrs }">
            <v-text-field v-model="date_salary" :label="$t('Salary Sign Date')" readonly
            v-bind="attrs" v-on="on" outlined dense hide-details
            prepend-inner-icon="mdi-calendar" clearable @click:clear="date_salary = null">
        </v-text-field>
    </template>
    <v-date-picker v-model="date_salary" @input="dateSalary = false" header-color="teal"
    :locale="$i18n.locale == 'cn' ? 'zh' : $i18n.locale">
</v-date-picker>
</v-menu>
</v-col>
<v-col cols="2">
    <v-menu v-model="replydate" :close-on-content-click="false" transition="scale-transition">
        <template v-slot:activator="{ on, attrs }">
            <v-text-field v-model="reply_date" :label="$t('Candidate reply date')" readonly
            v-bind="attrs" v-on="on" outlined dense hide-details
            prepend-inner-icon="mdi-calendar" clearable @click:clear="reply_date = null">
        </v-text-field>
    </template>
    <v-date-picker v-model="reply_date" @input="replydate = false" header-color="teal"
    :locale="$i18n.locale == 'cn' ? 'zh' : $i18n.locale">
</v-date-picker>
</v-menu>
</v-col>
<v-col cols="1">
    <v-checkbox v-model="reply_check" :label="$t('Candidate reply')" class="mt-1" color="red" value="yes"
    hide-details>
</v-checkbox>
</v-col>
<v-col cols="2">
    <v-menu v-model="dateInWork" :close-on-content-click="false" transition="scale-transition"
    offset-y>
    <template v-slot:activator="{ on, attrs }">
        <v-text-field v-model="inDateWork" :label="$t('Expected On board')" readonly
        v-bind="attrs" v-on="on" outlined dense hide-details
        prepend-inner-icon="mdi-calendar" clearable @click:clear="inDateWork = null">
    </v-text-field>
</template>
<v-date-picker v-model="inDateWork" @input="dateInWork = false" header-color="teal"
:locale="$i18n.locale == 'cn' ? 'zh' : $i18n.locale">
</v-date-picker>
</v-menu>
</v-col>
<v-col cols="7">
    <v-textarea v-model="candidate_reason" :label="$t('Candidate reject reason')" outlined dense auto-grow
    hide-details rows="1">
</v-textarea>
</v-col>


</v-row>
<!-- Additional Details -->
<v-row dense class="mt-2">
    <v-col cols="2">
        <v-menu v-model="dateAccInWork" :close-on-content-click="false"
        transition="scale-transition" offset-y>
        <template v-slot:activator="{ on, attrs }">
            <v-text-field v-model="inDateAccWork" :label="$t('On board')" readonly
            v-bind="attrs" v-on="on" outlined dense hide-details
            prepend-inner-icon="mdi-calendar" clearable @click:clear="inDateAccWork = null">
        </v-text-field>
    </template>
    <v-date-picker v-model="inDateAccWork" @input="dateAccInWork = false"
    header-color="teal" :locale="$i18n.locale == 'cn' ? 'zh' : $i18n.locale">
</v-date-picker>
</v-menu>
</v-col>
<v-col cols="2">
    <v-checkbox v-model="inWorker" :label="$t('Started Working')" class="mt-1" color="red"
    value="yes" hide-details>
</v-checkbox>
</v-col>
<v-col cols="2">
    <v-checkbox v-model="interview_bus" :label="$t('Recruited by Bus')" class="mt-1" color="red"
    value="yes" hide-details>
</v-checkbox>
</v-col>
<v-col cols="2">
    <v-checkbox v-model="reg_bus" :label="$t('Regist Bus Company')" class="mt-1" color="red"
    value="yes" hide-details>
</v-checkbox>
</v-col>
</v-row>
</v-card>
</v-col>
<v-col cols="12">
    <v-card class="pa-4 mb-2" elevation="2">
        <div class="section-header">
            <v-icon color="primary" class="mr-2">mdi-account</v-icon>
            <span class="text-h6">[{{ $t('Emp No. HRM') }}]</span>
        </div>
        <v-row dense>
            <v-col cols="2">
                <v-text-field v-model="empno_hrm" :label="$t('Emp No. HRM')" outlined dense
                hide-details></v-text-field>
            </v-col>
            <v-col cols="2">
                <v-combobox v-model="newDept" :items="item_newDept" item-text="name" item-value="code"
                :label="$t('HRM Dep.')" dense outlined hide-details></v-combobox>
            </v-col>
            <v-col cols="2">
                <v-combobox v-model="position" :items="item_position" :item-value="code"
                :item-text="item => item.name[this.$i18n.locale] || Object.values(item.name)[0]"
                :label="$t('Position')" dense outlined hide-details></v-combobox>
            </v-col>
            <v-col cols="2">
                <v-combobox v-model="deputy" :items="item_deputy" :label="$t('Select Rank')" dense outlined
                hide-details></v-combobox>
            </v-col>
            <v-col cols="2">
                <v-combobox v-model="level" :items="item_level" :label="$t('Job Level')" dense outlined
                hide-details></v-combobox>
            </v-col>
            <v-col cols="2">
                <v-combobox v-model="parameters" :items="item_parameters" :label="$t('Select Parameter')"
                dense outlined hide-details></v-combobox>
            </v-col>
            <v-col cols="1">
                <v-combobox v-model="time_trial" :items="item_time_trial" :label="$t('Trial Period')" dense
                outlined hide-details></v-combobox>
            </v-col>
            <v-col cols="1">
                <v-combobox v-model="direct" :items="item_direct" item-value="id" item-text="name"
                :label="$t('D/I')" dense outlined hide-details></v-combobox>
            </v-col>
            <v-col cols="1">
                <v-combobox v-model="dantoc" :items="item_dantoc" :item-value="code" item-text="name"
                :label="$t('Select Ethnicity')" dense outlined hide-details></v-combobox>
            </v-col>
            <v-col cols="1">
                <v-autocomplete
                v-model="religious"
                :items="item_religious"
                :item-value="'code'"
                :item-text="item => item.name[this.$i18n.locale] || Object.values(item.name)[0]"
                :label="$t('Select Religious')"
                dense
                outlined
                hide-details
                return-object
                clearable
                ></v-autocomplete>
            </v-col>
            <v-col cols="1">
                <v-combobox v-model="married" :items="item_married" item-text="name" item-value="code"
                :label="$t('Marital Status')" dense outlined hide-details></v-combobox>
            </v-col>
            <v-col cols="1">
                <v-combobox v-model="nation" :items="item_nation" :label="$t('Country Code')" dense outlined
                hide-details></v-combobox>
            </v-col>
            <v-col cols="2">
                <v-combobox v-model="nationality" :items="item_nationality" :label="$t('Nationality Code')"
                dense outlined hide-details></v-combobox>
            </v-col>
            <v-col cols="2">
                <v-combobox v-model="birth_province" :items="item_birth_province" item-text="name"
                item-value="code" :label="$t('Birth Province')" dense outlined
                hide-details></v-combobox>
            </v-col>
            <v-col cols="2">
                <v-combobox v-model="province" :items="item_province" item-text="name" item-value="code"
                :label="$t('Province')" dense outlined hide-details></v-combobox>
            </v-col>
            <!-- <v-col cols="2">
                <v-text-field v-model="tmp_categoryid" :label="$t('Category ID')" outlined dense
                hide-details>
            </v-text-field>
        </v-col> -->
    </v-row>
</v-card>
</v-col>
<v-col cols="12" class="d-flex justify-end">
    <v-btn color="error" @click="deleteData" class="mr-3" :loading="loading">
        <v-icon left>mdi-delete</v-icon>
        {{ $t('Delete') }}
    </v-btn>
    <v-spacer></v-spacer>
    <v-btn color="primary" :to="{ name: 'index' }" class="mr-3">
        <v-icon left>mdi-arrow-left</v-icon>
        {{ $t('Back') }}
    </v-btn>
    <v-btn color="error" class="mr-3" @click="resetForm" :loading="loading">
        <v-icon left>mdi-reload</v-icon>
        {{ $t('Reset') }}
    </v-btn>
    <v-btn color="success" @click=saveDb :loading="loading">
        <v-icon left>mdi-content-save</v-icon>
        {{ $t('Submit') }}
    </v-btn>
</v-col>
</v-row>
<v-dialog v-model="dialogSourceRecuiting" width="1000">
    <v-card>
        <v-card-title class="text-h5" style="background-color: teal; color: white">
            <v-icon color="white" left>mdi-cog-outline</v-icon>
            <span>{{ $t("Source recruiting") }}</span>
            <v-spacer></v-spacer>
            <v-icon @click="dialogSourceRecuiting = false" color="white">mdi-close-box</v-icon>
        </v-card-title>
        <v-card-text>
            <v-row>
                <v-col cols="12">
                    <v-row no-gutters align="center">
                        <v-col cols="3" class="pr-2 mt-3">
                            <v-text-field v-model="input_source.vi" :label="$t('Recruitment Source (VI)')"
                            outlined dense clearable hide-details>
                        </v-text-field>
                    </v-col>
                    <v-col cols="3" class="px-2 mt-3">
                        <v-text-field v-model="input_source.en" :label="$t('Recruitment Source (EN)')"
                        outlined dense clearable hide-details>
                    </v-text-field>
                </v-col>
                <v-col cols="3" class="px-2 mt-3">
                    <v-text-field v-model="input_source.cn" :label="$t('Recruitment Source (CN)')"
                    outlined dense clearable hide-details>
                </v-text-field>
            </v-col>
            <v-col cols="3" class="pl-2 d-flex align-center mt-3">
                <v-btn color="primary" @click="resetSourceForm">
                    <v-icon left>mdi-refresh</v-icon>
                    {{ $t('Reset') }}
                </v-btn>
                <v-btn color="success" class="ml-2" @click="saveSourceRecruiting">
                    <v-icon left>mdi-plus</v-icon>
                    {{ $t('Save') }}
                </v-btn>
            </v-col>
        </v-row>
    </v-col>
    <v-col cols="12">
        <v-data-table :headers="headersThongKe" :items="dataList" :items-per-page="10"
        class="elevation-3" :footer-props="{
            showFirstLastPage: true,
            firstIcon: 'mdi-arrow-collapse-left',
            lastIcon: 'mdi-arrow-collapse-right',
            prevIcon: 'mdi-minus',
            nextIcon: 'mdi-plus',
            'items-per-page-text': $t('Rows per page'),
            'items-per-page-options': [5, 10, 15],
        }">
        <template v-slot:[`item.en`]="{ item }">
            {{ item.name.en }}
        </template>
        <template v-slot:[`item.cn`]="{ item }">
            {{ item.name.cn }}
        </template>
        <template v-slot:[`item.vi`]="{ item }">
            {{ item.name.vi }}
        </template>
        <template v-slot:[`item.action`]="{ item }">
            <v-icon @click="edit_recruit(item)" color="error">mdi-square-edit-outline</v-icon>
        </template>
        <template v-slot:[`header.dem_dept`]="{ header }">
            {{ $t("Dept") }}
        </template>
        <template v-slot:[`header.dem_position`]="{ header }">
            {{ $t("Position") }}
        </template>
        <template v-slot:[`header.sub_position`]="{ header }">
            {{ $t("Sub position") }}
        </template>
        <template v-slot:[`header.dem_amount`]="{ header }">
            {{ $t("Amount") }}
        </template>
        <template v-slot:[`header.hired`]="{ header }">
            {{ $t("Hired") }}
        </template>
        <template v-slot:[`header.dem_inputdate`]="{ header }">
            {{ $t("Input date") }}
        </template>
        <template v-slot:[`header.dem_note`]="{ header }">
            {{ $t("Note") }}
        </template>
        <template v-slot:[`header.action`]="{ header }">
            {{ $t("Action") }}
        </template>
    </v-data-table>
</v-col>
</v-row>
</v-card-text>
</v-card>
</v-dialog>
<v-dialog v-model="dialogDemand" width="1400px">
    <v-card>
        <v-card-title class="text-h5" style="background-color: teal; color: white">
            <v-icon color="white" left>mdi-cog-outline</v-icon>
            <span>{{ $t("Demand") }}</span>
            <v-spacer></v-spacer>
            <v-icon @click="dialogDemand = false" color="white">mdi-close-box</v-icon>
        </v-card-title>
        <v-card-text>
            <v-row>
                <v-col cols="12" class="mt-5">
                    <v-data-table :headers="headersDemand" :items="dataListDemand" :items-per-page="10"
                    class="elevation-3" :footer-props="{
                        showFirstLastPage: true,
                        firstIcon: 'mdi-arrow-collapse-left',
                        lastIcon: 'mdi-arrow-collapse-right',
                        prevIcon: 'mdi-minus',
                        nextIcon: 'mdi-plus',
                        'items-per-page-text': $t('Rows per page'),
                        'items-per-page-options': [5, 10, 15],
                    }">
                    <template v-slot:[`item.department`]="{ item }">
                        {{ item.department }}
                    </template>
                    
                    <template v-slot:[`item.dem_unit`]="{ item }">
                        {{ item.dem_unit }}
                    </template>
                    <template v-slot:[`item.dem_position`]="{ item }">
                        {{ item.dem_position }}
                    </template>
                    <template v-slot:[`item.dem_sub_position`]="{ item }">
                        {{ item.dem_sub_position }}
                    </template>
                    <template v-slot:[`item.quantity`]="{ item }">
                        {{ item.quantity }}
                    </template>
                    <template v-slot:[`item.hired`]="{ item }">
                        {{ item.hired }}
                    </template>
                    <!-- stocknumber -->
                    <template v-slot:[`item.stocknumber`]="{ item }">
                        {{ item.stocknumber }}
                    </template>
                    <template v-slot:[`item.dem_inputdate`]="{ item }">
                        {{ item.dem_inputdate }}
                    </template>
                    <template v-slot:[`item.content`]="{ item }">
                        {{ item.content }}
                    </template>
                    <template v-slot:[`item.dem_note`]="{ item }">
                        <div class="note-text" @click="showNoteDialog(item)">
                            {{ truncateText(item.dem_note) }}
                        </div>
                    </template>
                    <template v-slot:[`item.action`]="{ item }">
                        <v-btn @click="selectDemand(item)" color="success" small dark>
                            <v-icon left>mdi-check-bold</v-icon>
                            {{ $t('Select') }}
                        </v-btn>
                    </template>
                    <template v-slot:[`header.department`]="{ header }">
                        {{ $t("Department") }}
                    </template>
                    <!-- dem_unit -->
                    <template v-slot:[`header.dem_unit`]="{ header }">
                        {{ $t("Unit") }}
                    </template>
                    <template v-slot:[`header.dem_position`]="{ header }">
                        {{ $t("Position") }}
                    </template>
                    <template v-slot:[`header.dem_sub_position`]="{ header }">
                        {{ $t("Sub position") }}
                    </template>
                    <template v-slot:[`header.dem_amount`]="{ header }">
                        {{ $t("Quantity") }}
                    </template>
                    <template v-slot:[`header.hired`]="{ header }">
                        {{ $t("Hired") }}
                    </template>
                    <template v-slot:[`header.stocknumber`]="{ header }">
                        {{ $t("Stock number") }}
                    </template>
                    <template v-slot:[`header.dem_inputdate`]="{ header }">
                        {{ $t("Input date") }}
                    </template>
                    <template v-slot:[`header.content`]="{ header }">
                        {{ $t("Content") }}
                    </template>
                    <template v-slot:[`header.dem_note`]="{ header }">
                        {{ $t("Note") }}
                    </template>
                    <template v-slot:[`header.action`]="{ header }">
                        {{ $t("Action") }}
                    </template>
                    
                </v-data-table>
            </v-col>
        </v-row>
    </v-card-text>
</v-card>
</v-dialog>
<v-overlay :value="loading">
    <v-progress-circular indeterminate size="64"></v-progress-circular>
</v-overlay>
<v-dialog v-model="noteDialog" max-width="500">
    <v-card>
        <v-card-title class="text-h6" style="background-color: #424242; color: white">
            {{ $t('Note') }}
            <v-spacer></v-spacer>
            <v-icon @click="noteDialog = false" color="white">mdi-close</v-icon>
        </v-card-title>
        <v-card-text class="pt-4">
            <p style="white-space: pre-wrap;">{{ this.selectedNote }}</p>
        </v-card-text>
    </v-card>
</v-dialog>
<v-dialog v-model="resignDialog" width="1500" class="pa-1">
    <v-card>
        <v-card-title class="text-h5" style="background-color: teal; color: white">
            <v-icon color="white" left>mdi-account-off</v-icon>
            <span>{{ $t("Resignation History") }}</span>
            <v-spacer></v-spacer>
            <v-icon @click="resignDialog = false" color="white">mdi-close-box</v-icon>
        </v-card-title>
        <v-card-text>
            <v-data-table :headers="resignHeaders" :items="resignData" class="elevation-1 mt-4" :footer-props="{
                'items-per-page-text': $t('Rows per page'),
            }">
            <template v-slot:[`item.er_gender`]="{ item }">
                {{ $t(item.er_gender) }}
            </template>
            <template v-slot:[`item.er_keyindate`]="{ item }">
                {{ formatDate(item.er_keyindate) }}
            </template>
            <template v-slot:[`item.er_resigndate`]="{ item }">
                {{ formatDate(item.er_resigndate) }}
            </template>
            <template v-slot:[`item.er_address`]="{ item }">
                <div class="text-wrap">
                    <v-tooltip bottom>
                        <template v-slot:activator="{ on, attrs }">
                            <span class="truncated-text">
                                {{ item.er_address }}
                            </span>
                        </template>
                        <span>{{ item.er_address }}</span>
                    </v-tooltip>
                </div>
            </template>
            <template v-slot:[`item.er_reason`]="{ item }">
                <div class="text-wrap">
                    <v-tooltip bottom>
                        <template v-slot:activator="{ on, attrs }">
                            <span class="truncated-text">
                                {{ getReason(item.er_reason) }}
                            </span>
                        </template>
                        <span>{{ getReason(item.er_reason) }}</span>
                    </v-tooltip>
                </div>
            </template>
            <template v-slot:[`item.er_note`]="{ item }">
                <div class="text-wrap" v-if="item.er_note">
                    <v-tooltip bottom>
                        <template v-slot:activator="{ on, attrs }">
                            <span class="truncated-text">
                                {{ item.er_note }}
                            </span>
                        </template>
                    </v-tooltip>
                </div>
                <span v-else>-</span>
            </template>
            <template v-slot:[`header.er_note`]="{ header }">
                <v-tooltip bottom>
                    <template v-slot:activator="{ on, attrs }">
                        <span v-bind="attrs" v-on="on">Note</span>
                    </template>
                    <span>Click icon to view full note</span>
                </v-tooltip>
            </template>
            <template v-slot:[`item.er_note`]="{ item }">
                <v-icon v-if="item.er_note" small class="ml-2" color="primary"
                @click="showFullNote(item.er_note)">
                mdi-text-box-search
            </v-icon>
        </template>
        <template v-slot:[`header.er_empid`]="{ header }">
            {{ $t('Empno') }}
        </template>
        <template v-slot:[`header.er_name`]="{ header }">
            {{ $t('Name') }}
        </template>
        <template v-slot:[`header.er_deptname`]="{ header }">
            {{ $t('Dept') }}
        </template>
        <template v-slot:[`header.er_joblevel`]="{ header }">
            {{ $t('Position') }}
        </template>
        <template v-slot:[`header.er_seniority`]="{ header }">
            {{ $t('Seniority') }}
        </template>
        <template v-slot:[`header.er_indate`]="{ header }">
            {{ $t('In date') }}
        </template>
        <template v-slot:[`header.er_resigndate`]="{ header }">
            {{ $t('Resign date') }}
        </template>
        <template v-slot:[`header.er_reason`]="{ header }">
            {{ $t('Reason') }}
        </template>
        <template v-slot:[`header.er_note`]="{ header }">
            {{ $t('Note') }}
        </template>
    </v-data-table>
</v-card-text>
<v-card-actions>
    <v-spacer></v-spacer>
    <v-btn color="error" @click="resignDialog = false" outlined>
        <v-icon left>mdi-close</v-icon>
        {{ $t("CLOSE") }}
    </v-btn>
</v-card-actions>
</v-card>
</v-dialog>
<v-dialog v-model="confirmDialog" max-width="400">
    <v-card>
        <v-card-title class="text-h5">{{ $t('Warning') }}</v-card-title>
        <v-card-text>{{ $t('Do you want to delete the candidate?') }}</v-card-text>
        <v-card-actions>
            <v-spacer></v-spacer>
            <v-btn color="grey darken-1" text @click="confirmDialog = false">Cancel</v-btn>
            <v-btn color="red darken-1" text @click="confirmDelete">OK</v-btn>
        </v-card-actions>
    </v-card>
</v-dialog>
<v-dialog v-model="noteDialogFull" max-width="600">
    <v-card>
        <v-card-title class="headline grey lighten-3">
            {{ $t('Note Details') }}
            <v-spacer></v-spacer>
            <v-btn icon @click="noteDialogFull = false">
                <v-icon>mdi-close</v-icon>
            </v-btn>
        </v-card-title>
        <v-card-text class="pt-4">
            <div style="white-space: pre-wrap;">{{ selectedFullNote }}</div>
        </v-card-text>
        <v-card-actions>
            <v-spacer></v-spacer>
            <v-btn color="primary" text @click="noteDialogFull = false">
                {{ $t('Close') }}
            </v-btn>
        </v-card-actions>
    </v-card>
</v-dialog>
</v-app>
</template>
<script>
import dayjs from "dayjs";
export default {
    data() {
        return {
            loading: false,
            api: 'http://gmo021.cansportsvg.com/api/vg-recuitingReport/',
            id: '',
            today: dayjs().format('YYYY-MM-DD'),
            name: '',
            gender: '0',
            dateBirth: '',
            cccd: '',
            selectedDatecccd: '',
            loc_apply: '',
            dept_apply: '',
            date_hr_inter: (new Date(Date.now() - (new Date()).getTimezoneOffset() * 60000)).toISOString().substr(0, 10),
            date_hr_review: (new Date(Date.now() - (new Date()).getTimezoneOffset() * 60000)).toISOString().substr(0, 10),
            date_dept_inter: '',
            date_dept_review: '',
            inDateWork: '',
            inDateAccWork: '',
            hrAcc: '',
            deptACC: '',
            inWorker: '',
            interview_bus: '',
            reg_bus: '',
            inVG: '',
            empno_old: '',
            source_recruit: '',
            comp_return: '',
            remark: '',
            reason: '',
            date_cv: '',
            date_salary: '',
            tel: '',
            address: '',
            sub_tel: '',
            sub_address: '',
            nation: 'VN',
            nationality: 'Việt Nam',
            empno_hrm: '',
            newDept: '',
            position: '',
            time_trial: '',
            parameters: '',
            dantoc: '',
            religious: '',
            deputy: '',
            level: '',
            code_mc: 'VG',
            loc_work: 'VG',
            direct: '',
            married: '',
            edu: '',
            birth_province: 'Tây Ninh',
            province: 'Tây Ninh',
            bus_info: '',
            school_gra: '',
            change_date: '',
            tmp_categoryid: '00001',
            item_loc_apply: ['Worker', 'Staff', 'Staff (lang)', 'Leader', 'Translator', 'Engineer'],
            item_dept_apply: [],
            item_source_recruit: [],
            item_comp_return: ['LuThai', 'Brotex', 'Sailun', 'Gain Lucky', 'HAVina', 'Pouhung'],
            item_nation: ['CA', 'CN', 'DE', 'ES', 'FR', 'IN', 'JP', 'KH', 'MA', 'MM', 'PH', 'SG', 'TW', 'US', 'VN'],
            item_nationality: ['Canada', 'China', 'Germany', 'Spain', 'France', 'India', 'Japan', 'Cambodia', 'Morocco', 'Myanmar', 'Philippines', 'Singapore', 'Taiwan', 'United States', 'Vietnam'],
            item_newDept: [],
            item_position: [],
            item_time_trial: [6, 30, 60],
            item_parameters: ['A01', 'A02', 'CN01', 'CN02', 'CN03', 'TW-VN'],
            item_dantoc: [],
            item_religious: [],
            item_deputy: ['1000A', '2000A', '3000A', '4000A', '5000A', '6000A', '7000A', '8000A', '9000A'],
            item_level: [1, 2, 3, 4, 5, 6, 7, 8, 9],
            item_code_mc: ['VG'],
            item_loc_work: ['VG'],
            item_direct: [],
            item_married: [],
            item_edu: [],
            item_birth_province: [],
            item_province: [],
            item_bus_info: ['Ben Cau Tri', 'Tan Chau Tri', 'Chau Thanh Vui', 'Tan Bien Cuong'],
            code: '',
            birthMenu: false,
            cccdMenu: false,
            dateMenu: false,
            dateSalary: false,
            dateHR: false,
            dateHRAcc: false,
            datedept: false,
            datedeptAcc: false,
            dateInWork: false,
            dateAccInWork: false,
            change_date_acc: false,
            dialogSourceRecuiting: false,
            input_source: {
                vi: '',
                en: '',
                cn: ''
            },
            headersThongKe: [{ text: 'Recruitment Source (VI)', align: 'start', sortable: false, value: 'vi' },
            { text: 'Recruitment Source (EN)', value: 'en' },
            { text: 'Recruitment Source (CN)', value: 'cn' },
            { text: 'Action', value: 'action', sortable: false }
            ],
            dataList: [],
            dialogDemand: false,
            dataListDemand: [],
            headersDemand: [
            { text: 'ID', align: 'start', sortable: false, value: 'id' },
            { text: 'Department', align: 'start', sortable: false, value: 'department' },
            { text: 'Unit', align: 'start', sortable: false, value: 'dem_unit' },
            { text: 'Position', value: 'dem_position', sortable: false, align: 'center' },
            { text: 'Sub Position', value: 'dem_sub_position', sortable: false, align: 'center' },
            { text: 'Quantity', value: 'dem_amount', sortable: false, align: 'center' },
            { text: 'Hired', value: 'hired', sortable: false, align: 'center' },
            { text: 'Still in need', value: 'stocknumber', sortable: false, align: 'center' },
            { text: 'Dem Input Date', value: 'dem_inputdate', sortable: false },
            { text: 'Content', value: 'dem_note', width: '150px', sortable: false },
            { text: 'Action', value: 'action', sortable: false }
            ],
            dm_id: '',
            dm_Subpos: '',
            noteDialog: false,
            selectedNote: '',
            dataCadidates: [],
            nameError: '',
            rules: {
                required: value => !!value || 'Required.',
                number: value => /^\d+$/.test(value) || 'Must be numbers only',
                length: value => value.length === 12 || 'Must be exactly 12 digits'
            },
            allDepartments: {},
            positionMapping: {
                'Worker': ['Worker'],
                'Staff': ['Staff'],
                'Staff (lang)': ['Staff (lang)'],
                'Leader': ['Leader'],
                'Translator': ['Translator'],
                'Engineer': ['Engineer']
            },
            resignData: [],
            resignDialog: false,
            resignHeaders: [
            { text: 'Empno', value: 'er_empid', align: 'start', },
            { text: 'Name', value: 'er_name', },
            { text: 'Dept', value: 'er_deptid', },
            { text: 'Job Level', value: 'er_joblevel', },
            { text: 'Seniority', value: 'er_seniority', },
            { text: 'In date', value: 'er_indate' },
            { text: 'Resignation Date', value: 'er_resigndate', },
            { text: 'Reason', value: 'er_reason', sortable: false },
            { text: 'Note', value: 'er_note', sortable: false },
            ],
            reasons: [],
            confirmDialog: false,
            noteDialogFull: false,
            selectedFullNote: '',
            work_exp: '',
            work_exp_pt: '',
            ex_company: '',
            ex_position: '',
            dept_reason: '',
            candidate_reason: '',
            email: '',
            reply_check: '',
            reply_date: '',
            replydate: false,
            subItems: [],
            pos: [],
        }
    },
    watch: {
        tel(newVal) {
            this.sub_tel = newVal;
        },
        address(newVal) {
            this.sub_address = newVal;
        },
        dept_apply: {
            handler(newVal) {
                if (newVal) {
                    this.updateNewDeptItems();
                } else {
                    this.item_newDept = [];
                    this.newDept = null;
                }
            },
            deep: true
        },
        loc_apply: {
            handler(newVal) {
                if (newVal) {
                    // Find the matching position from item_position based on loc_apply
                    const matchingPosition = this.item_position.find(pos =>
                    this.positionMapping[newVal]?.includes(pos.name[this.$i18n.locale] || pos.name)
                    );
                    if (matchingPosition) {
                        this.position = matchingPosition;
                    }
                }
            },
            immediate: true
        },
        newDept: {
            handler(newVal) {
                if (newVal) {
                    this.updateDirectValue();
                }
            },
            immediate: true
        },
        position: {
            handler(newVal) {
                this.updateTrialPeriod();
            },
            immediate: true
        },
        edu: {
            handler(newVal) {
                this.updateTrialPeriod();
            },
            immediate: true
        }
    },
    methods: {
        async getReasons() {
            try {
                let res = await this.$axios.get(this.api + 'getDataReasonResign');
                if (res.status === 200) {
                    this.reasons = res.data.dataReasonResign;
                }
            } catch (error) {
                console.log(error);
                this.$notify({
                    title: 'Error',
                    text: 'Failed to load reasons',
                    type: 'error'
                });
            }
        },
        async getAllDataCandidate() {
            let params = {
                emp_id: this.cccd,
            };
            try {
                const response = await this.$axios.post(this.api + 'GetDataByCCCD', params);
                this.dataCadidates = response.data;
            } catch (error) {
                console.error("Error fetching employee data:", error);
            } finally {
            }
        },
        async fetchDemand() {
            let params = {
                dem_dept: this.dept_apply.name,
            };
            try {
                const res = await this.$axios.post(this.api + 'getDemandByDept', params);
                this.dataListDemand = res.data.map(demand => {
                    const dept = this.item_dept_apply.find(d => String(d.id) === String(demand.dem_dept));
                    return {
                        ...demand,
                        department: dept ? dept.code : demand.dem_dept,
                        quantity: demand.dem_amount,
                        content: demand.dem_note
                    };
                });
            } catch (error) {
                console.log(error);
            }
        },
        
        
        getDataDemandByDept() {
            this.fetchDemand();
            this.dialogDemand = true;
        },
        
        selectDemand(item) {
            this.dm_id = item.id;
            this.loc_apply = item.dem_position;
            this.dm_Subpos = item.dem_sub_position;
            this.dialogDemand = false;
        },
        async saveDbDemand() {
            this.loading = true;
            try {
                const demandRes = await this.$axios.get(this.api + 'getDemandById/' + this.dm_id);
                const existingData = demandRes.data;
                const countRes = await this.$axios.get(this.api + 'countDemandById/' + this.dm_id);
                const stocknumber = countRes.data;
                const newCandidate = {
                    empno: this.empno_hrm,
                    date: this.inDateAccWork,
                    name: this.name
                };
                let candidates = [];
                if (existingData && existingData.dem_candidates) {
                    if (typeof existingData.dem_candidates === 'string') {
                        candidates = JSON.parse(existingData.dem_candidates);
                    } else {
                        candidates = existingData.dem_candidates;
                    }
                }
                const existingIndex = candidates.findIndex(c => c.empno === this.empno_hrm);
                
                if (existingIndex !== -1) {
                    candidates[existingIndex] = newCandidate;
                    this.$notify({
                        title: 'Update',
                        text: 'Updated existing candidate information',
                        type: 'info'
                    });
                } else {
                    candidates.push(newCandidate);
                }
                
                let params = {
                    id: this.dm_id,
                    dem_fullfilldate: this.inDateAccWork,
                    stocknumber: stocknumber,
                    dem_candidates: candidates
                };
                const res = await this.$axios.post(this.api + 'saveUpdateDemand', params);
                
                if (res.status === 200) {
                    this.$notify({
                        title: 'Success',
                        text: existingIndex !== -1 ? 'Demand data updated successfully' : 'Demand data saved successfully',
                        type: 'success'
                    });
                }
            } catch (error) {
                console.error('Error saving demand:', error);
                this.$notify({
                    title: 'Error',
                    text: 'Failed to save demand data',
                    type: 'error'
                });
            } finally {
                this.loading = false;
            }
        },
        async getDeptCode() {
            try {
                const res = await this.$axios.get(this.api + 'getDataDeptCode');
                const rawData = res.data.dataDeptCode.map(item => ({
                    department: item.department,
                    sub_division: item.sub_division,
                    id: item.id,
                    end_date: item.end_date,
                    fid: item.fid
                }));
                const processedData = this.processDepartmentData(rawData);
                this.item_dept_apply = processedData.mainDepartments;
                this.allDepartments = processedData.subDepartments;
                if (this.dept_apply) {
                    this.updateNewDeptItems();
                }
                
            } catch (error) {
                console.error('Error in getDeptCode:', error);
                this.$notify({
                    title: 'Error',
                    text: 'Failed to fetch department data',
                    type: 'error'
                });
            }
        },
        
        processDepartmentData(data) {
            const mainDepartments = new Map();
            const subDepartments = {};
            
            // First pass: collect all unique departments
            data.forEach(item => {
                const dept = item.department;
                const deptId = item.id;
                
                if (!mainDepartments.has(dept)) {
                    mainDepartments.set(dept, {
                        code: dept,
                        name: dept,
                        id: deptId,
                        deptName_temp: dept
                    });
                }
                
                if (!subDepartments[dept]) {
                    subDepartments[dept] = new Set();
                }
                
                // Only add sub-division if end_date is null
                if (item.sub_division && item.end_date === null) {
                    subDepartments[dept].add({
                        code: item.sub_division,
                        name: item.sub_division,
                        id: item.id,
                        fid: item.fid 
                    });
                }
            });
            
            // Convert Sets to Arrays and create final structure
            return {
                mainDepartments: Array.from(mainDepartments.values()),
                subDepartments: Object.fromEntries(
                Object.entries(subDepartments).map(([key, value]) => [
                key,
                Array.from(value)
                ])
                )
            };
        },
        
        safeParseJSON(value) {
            try {
                return typeof value === 'string' ? JSON.parse(value) : value;
            } catch (e) {
                return value;
            }
        },
        
        updateNewDeptItems() {
            if (!this.dept_apply?.code) {
                this.item_newDept = [];
                this.newDept = null;
                return;
            }
            
            const deptCode = this.dept_apply.code;
            let subDepts = this.allDepartments[deptCode] ;
            
            this.item_newDept = subDepts;
            
            if (this.newDept && !subDepts.find(x => x.code === this.newDept.code)) {
                this.newDept = null;
            }
            
            this.$nextTick(() => {
                this.updateDirectValue();
            });
        },
        async getAllDuty() {
            try {
                const res = await this.$axios.get(this.api + 'getDataDutyHrm');
                let _rData = res.data.dataDutyHrm;
                
                const positions = _rData.map((x) => {
                    let name, code;
                    try {
                        name = JSON.parse(x.duty_name);
                    } catch (e) {
                        name = x.duty_name;
                    }
                    try {
                        code = JSON.parse(x.duty_no);
                    } catch (e) {
                        code = x.duty_no;
                    }
                    return {
                        id: x.id,
                        code: code,
                        name: typeof name === 'object' ? name : {
                            vi: name,
                            en: name,
                            cn: name
                        }
                    };
                });
                
                this.item_position = positions.sort((a, b) => {
                    const priorityOrder = ['C02', 'B09'];
                    
                    const indexA = priorityOrder.indexOf(a.code);
                    const indexB = priorityOrder.indexOf(b.code);
                    
                    if (indexA !== -1 && indexB !== -1) {
                        return indexA - indexB;
                    }
                    if (indexA !== -1) return -1;
                    if (indexB !== -1) return 1;
                    return 0;
                });
                
                if (this.loc_apply) {
                    const matchingPosition = this.item_position.find(pos =>
                    this.positionMapping[this.loc_apply]?.includes(
                    pos.name[this.$i18n.locale] || Object.values(pos.name)[0]
                    )
                    );
                    if (matchingPosition) {
                        this.position = matchingPosition;
                    }
                }
                
            } catch (error) {
                console.log(error);
            }
        },
        async getAllNation() {
            try {
                const res = await this.$axios.get(this.api + 'getDataNationHrm');
                let _rData = res.data.dataNationHrm;
                
                this.item_dantoc = _rData.map((x) => {
                    let name, code;
                    try {
                        name = JSON.parse(x.nation_name);
                    } catch (e) {
                        name = x.nation_name;
                    }
                    try {
                        code = JSON.parse(x.nation_code);
                    } catch (e) {
                        code = x.nation_code;
                    }
                    return {
                        code: code,
                        name: name[this.$i18n.locale] || name
                    };
                });
            } catch (error) {
                console.log(error);
            }
        },
        async getAllReligious() {
            try {
                const res = await this.$axios.get(this.api + 'getDataReligiousHrm');
                let _rData = res.data.dataReligiousHrm;
                
                this.item_religious = _rData.map((x) => {
                    let name, code;
                    try {
                        name = JSON.parse(x.religious_name);
                    } catch (e) {
                        name = {
                            vi: x.religious_name,
                            en: x.religious_name,
                            cn: x.religious_name
                        };
                    }
                    try {
                        code = JSON.parse(x.religious_no); 
                    } catch (e) {
                        code = x.religious_no;
                    }
                    return {
                        code: code,
                        name: name
                    };
                });
            } catch (error) {
                console.log(error);
            }
        },
        async getAllEdu() {
            try {
                const res = await this.$axios.get(this.api + 'getDataEdu');
                let _rData = res.data.dataEdu;
                
                this.item_edu = _rData.map((x) => {
                    let name, code;
                    try {
                        name = JSON.parse(x.edu_name);
                    } catch (e) {
                        name = x.edu_name;
                    }
                    try {
                        code = JSON.parse(x.edu_no);
                    } catch (e) {
                        code = x.edu_no;
                    }
                    return {
                        code: code,
                        name: name[this.$i18n.locale] || name
                    };
                });
                
                
            } catch (error) {
                console.log(error);
            }
        },
        async getAllProvince() {
            try {
                const res = await this.$axios.get(this.api + 'getDataBirthProvince');
                let _rData = res.data.dataBirthProvince;
                
                const processProvinceData = (province) => {
                    let name, code;
                    try {
                        name = JSON.parse(province.province_name);
                    } catch (e) {
                        name = province.province_name;
                    }
                    try {
                        code = JSON.parse(province.province_no);
                    } catch (e) {
                        code = province.province_no;
                    }
                    return {
                        code: code,
                        name: name[this.$i18n.locale] || name
                    };
                };
                
                this.item_birth_province = _rData.map(processProvinceData);
                this.item_province = _rData.map(processProvinceData);
                
            } catch (error) {
                console.log(error);
            }
        },
        async getAllDirect() {
            try {
                const res = await this.$axios.get(this.api + 'getDataDirect');
                let _rdata = res.data.dataDirect;
                
                this.item_direct = _rdata.map((x) => {
                    let name, code;
                    try {
                        name = JSON.parse(x.name);
                    } catch (e) {
                        name = x.name;
                    }
                    try {
                        code = JSON.parse(x.code);
                    } catch (e) {
                        code = x.code;
                    }
                    return {
                        id: code,  // Thêm id để match với item-value
                        code: code,
                        name: name[this.$i18n.locale] || name
                    };
                });
            } catch (error) {
                console.log(error);
            }
        },
        async getAllMarried() {
            try {
                const res = await this.$axios.get(this.api + 'getDataMarrage');
                let _rdata = res.data.dataMarrage;
                this.item_married = _rdata.map((x) => {
                    let name, code;
                    try {
                        name = JSON.parse(x.name);
                    } catch (e) {
                        name = x.name;
                    }
                    try {
                        code = JSON.parse(x.code);
                    } catch (e) {
                        code = x.code;
                    }
                    return {
                        code: code,
                        name: name[this.$i18n.locale] || name
                    };
                });
            } catch (error) {
                console.log('Error fetching married data:', error);
            }
        },
        // func save data to db
        async saveDb() {
            this.validateName();
            if (this.nameError) {
                this.$notify({
                    title: 'Error',
                    text: this.$t('Name is required'),
                    type: 'error'
                });
                this.focusNameField();
                return;
            }
            
            this.loading = true;
            const currentUser = this.$session.get("recruiting-report").username;
            let params = {
                id: this.id,
                key_in_date: this.today,
                candidate_name: this.name,
                dateofbirth: this.dateBirth,
                gender: this.gender,
                emp_id: this.cccd,
                position: this.loc_apply,
                apply_dp: this.dept_apply?.name || '', // Thay đổi để lưu id của department
                hr_iv_date: this.date_hr_inter,
                hr_ac_date: this.date_hr_review,
                dp_iv_date: this.date_dept_inter,
                dp_ac_date: this.date_dept_review,
                hr_ac_qu: this.hrAcc,
                dp_ac_qu: this.deptACC,
                reg: this.inWorker,
                ex_en_date: this.inDateWork,
                act_en_date: this.inDateAccWork,
                recru_source: this.source_recruit?.code, // Add fallback to null
                brou_com_bus: this.interview_bus,
                regedForBus: this.reg_bus,
                vg_work_times: this.inVG,
                old_empno: this.empno_old,
                re_vg_from: this.comp_return,
                cv_received_at: this.date_cv,
                salary_signed_at: this.date_salary,
                note: this.remark,
                school: this.school_gra,
                sub_position: this.dm_Subpos,
                emp_demandid: this.dm_id,
                user_input: this.id ? undefined : currentUser, // Only set on new records
                user_update: this.id ? currentUser : undefined, // Only set on updates
                regTel: this.tel,
                regAddress: this.address,
                commTel: this.sub_tel,
                commAddress: this.sub_address,
                national: this.nation,
                religious: this.religious?.code,
                newEmpno: this.empno_hrm,
                tmp_idyclass: this.parameters,
                tmp_departid: this.newDept?.code,
                tmp_dutyid: this.position?.code,
                ethnic: this.dantoc?.code,
                tmp_categoryid: this.tmp_categoryid,
                tmp_levelid: this.level,
                tmp_rankid: this.deputy,
                tmp_siteid: this.code_mc,
                tmp_workareaid: this.loc_work,
                isdirect: this.direct?.code,
                countryid: this.nationality,
                marrage: this.married?.code,
                birth_province: this.birth_province?.code,
                province: this.province?.code,
                edu: this.edu?.code,
                probation: this.time_trial,
                bus_info: this.bus_info,
                datecccd: this.selectedDatecccd,
                reason: this.reason,
                change_en_date: this.change_date,
                work_exp: this.work_exp,
                work_exp_pt: this.work_exp_pt,
                ex_company: this.ex_company,
                ex_position: this.ex_position,
                dept_reason: this.dept_reason,
                candidate_reason: this.candidate_reason,
                email: this.email,
                reply_check: this.reply_check,
                reply_date: this.reply_date,
                
                
            }
            try {
                const res = await this.$axios.post(this.api + 'savedb', params);
                if (res.status === 200) {
                    this.$notify({
                        title: 'Success',
                        text: this.id ? 'Data updated successfully' : 'Data saved successfully',
                        type: 'success'
                    });
                    this.resetForm();
                    this.$router.replace({
                        path: this.$route.path,
                        query: {}
                    });
                }
            } catch (error) {
                console.error('Error saving data:', error);
                this.$notify({
                    title: 'Error',
                    text: 'Failed to save data',
                    type: 'error'
                });
            } finally {
                this.loading = false;
            }
        },
        // reset form
        resetForm() {
            this.id = '';
            this.name = '';
            this.gender = '0';
            this.dateBirth = '';
            this.cccd = '';
            this.loc_apply = '';
            this.dept_apply = '';
            this.date_hr_inter = '';
            this.date_hr_review = '';
            this.date_dept_inter = '';
            this.date_dept_review = '';
            this.hrAcc = '';
            this.deptACC = '';
            this.inWorker = '';
            this.inDateWork = '';
            this.inDateAccWork = '';
            this.source_recruit = '';
            this.interview_bus = '';
            this.reg_bus = '';
            this.inVG = '';
            this.empno_old = '';
            this.comp_return = '';
            this.date_cv = '';
            this.date_salary = '';
            this.remark = '';
            this.school_gra = '';
            this.tel = '';
            this.address = '';
            this.sub_tel = '';
            this.sub_address = '';
            this.nation = 'VN';
            this.empno_hrm = '';
            this.parameters = '';
            this.newDept = '';
            this.position = '';
            this.dantoc = '';
            this.level = '';
            this.deputy = '';
            this.code_mc = 'VG';
            this.loc_work = 'VG';
            this.direct = '';
            this.nationality = 'Việt Nam';
            this.religious = '';
            this.married = '';
            this.birth_province = '';
            this.province = '';
            this.edu = '';
            this.time_trial = '';
            this.bus_info = '';
            this.selectedDatecccd = '';
            this.reason = '';
            this.change_date = '';
            this.dm_id = '';
            this.dm_Subpos = '';
            this.work_exp = '';
            this.work_exp_pt = '';
            this.ex_company = '';
            this.ex_position = '';
            this.dept_reason = '';
            this.candidate_reason = '';
            this.email = '';
            this.reply_check = '';
            this.reply_date = '';
        },
        async getAllByQuery() {
            try {
                await this.getDeptCode();
                
                const res = await this.$axios.get(this.api + 'getDataById/' + this.id);
                if (res.status === 200) {
                    let data = res.data;
                    const matchingDept = this.item_dept_apply.find(dept => dept.name === data.apply_dp);
                    if (matchingDept) {
                        this.dept_apply = matchingDept;
                        await this.$nextTick();
                        const subDepts = this.allDepartments[matchingDept.code] || [];
                        const matchingSubDept = subDepts.find(x => x.code === data.tmp_departid);
                        if (matchingSubDept) {
                            this.newDept = matchingSubDept;
                        }
                    }
                    
                    // Basic information
                    this.name = data.candidate_name;
                    this.gender = data.gender;
                    this.dateBirth = data.dateofbirth;
                    this.cccd = data.emp_id;
                    this.loc_apply = data.position;
                    
                    // Interview dates
                    this.date_hr_inter = data.hr_iv_date;
                    this.date_hr_review = data.hr_ac_date;
                    this.date_dept_inter = data.dp_iv_date;
                    this.date_dept_review = data.dp_ac_date;
                    
                    // Status flags
                    this.hrAcc = data.hr_ac_qu;
                    this.deptACC = data.dp_ac_qu;
                    this.inWorker = data.reg;
                    
                    // Dates
                    this.inDateWork = data.ex_en_date;
                    this.inDateAccWork = data.act_en_date;
                    this.date_cv = data.cv_received_at;
                    this.date_salary = data.salary_signed_at;
                    this.selectedDatecccd = data.datecccd;
                    this.change_date = data.change_en_date;
                    
                    // Recruitment info
                    this.source_recruit = this.item_source_recruit.find(x => String(x.code) === String(data.recru_source));
                    this.interview_bus = data.brou_com_bus;
                    this.reg_bus = data.regedForBus;
                    this.inVG = data.vg_work_times;
                    this.empno_old = data.old_empno;
                    this.comp_return = data.re_vg_from;
                    
                    // Personal info
                    this.remark = data.note;
                    this.school_gra = data.school;
                    this.tel = data.regTel;
                    this.address = data.regAddress;
                    this.sub_tel = data.commTel;
                    this.sub_address = data.commAddress;
                    
                    // System IDs and codes
                    this.dm_id = data.emp_demandid;
                    this.dm_Subpos = data.sub_position;
                    this.nation = data.national;
                    this.empno_hrm = data.newEmpno;
                    this.parameters = data.tmp_idyclass;
                    this.position = this.item_position.find(x => String(x.code) === String(data.tmp_dutyid));
                    this.tmp_categoryid = data.tmp_categoryid;
                    
                    // Additional information
                    this.dantoc = this.item_dantoc.find(x => String(x.code) === String(data.ethnic));
                    this.religious = this.item_religious.find(x => String(x.code) === String(data.religious));
                    this.level = data.tmp_levelid;
                    this.deputy = data.tmp_rankid;
                    this.code_mc = data.tmp_siteid;
                    this.loc_work = data.tmp_workareaid;
                    this.direct = this.item_direct.find(x => String(x.code) === String(data.isdirect));
                    this.nationality = data.countryid;
                    this.married = this.item_married.find(x => String(x.code) === String(data.marrage));
                    this.birth_province = this.item_birth_province.find(x => String(x.code) === String(data.birth_province));
                    this.province = this.item_province.find(x => String(x.code) === String(data.province));
                    this.edu = this.item_edu.find(x => String(x.code) === String(data.edu));
                    this.time_trial = data.probation;
                    this.bus_info = data.bus_info;
                    
                    // Additional fields that were missing
                    this.work_exp = data.work_exp;
                    this.work_exp_pt = data.work_exp_pt;
                    this.ex_company = data.ex_company;
                    this.ex_position = data.ex_position;
                    this.dept_reason = data.dept_reason;
                    this.candidate_reason = data.candidate_reason;
                    this.reason = data.reason;
                    
                    this.email = data.email;
                    this.reply_check = data.reply_check;
                    this.reply_date = data.reply_date;
                    
                }
                
            } catch (error) {
                console.log(error);
            }
        },
        async checkEmpno() {
            try {
                const res = await this.$axios.get(this.api + 'checkCccd/' + this.cccd);
                if (res.status === 200) {
                    this.inVG = res.data.count;
                    this.empno_old = res.data.EMPNO;
                    this.getDataResign();
                    if (this.inVG > 0) {
                        await this.getAllDataCandidate();
                        if (this.dataCadidates && Object.keys(this.dataCadidates).length > 0) {
                            const data = this.dataCadidates;
                            
                            this.dept_apply = this.item_dept_apply.find(dept => {
                                return String(dept.id) === String(data.apply_dp);
                            });
                            await this.$nextTick();
                            // this.newDept = this.item_newDept.find(x => String(x.code) === String(data.tmp_departid));
                            this.name = data.candidate_name;
                            this.gender = data.gender;
                            this.dateBirth = this.formatDate(data.dateofbirth);
                            // this.loc_apply = data.position;
                            // this.date_hr_inter = this.formatDate(data.hr_iv_date);
                            // this.date_hr_review = this.formatDate(data.hr_ac_date);
                            // this.date_dept_inter = this.formatDate(data.dp_iv_date);
                            // this.date_dept_review = this.formatDate(data.dp_ac_date);
                            // this.hrAcc = data.hr_ac_qu;
                            // this.deptACC = data.dp_ac_qu;
                            // this.inWorker = data.reg;
                            // this.inDateWork = this.formatDate(data.ex_en_date);
                            // this.inDateAccWork = this.formatDate(data.act_en_date);
                            // this.source_recruit = this.item_source_recruit.find(x => String(x.code) === String(data.recru_source));
                            // this.interview_bus = data.brou_com_bus;
                            // this.reg_bus = data.regedForBus;
                            // this.empno_old = data.old_empno;
                            // this.comp_return = data.re_vg_from;
                            // this.date_cv = this.formatDate(data.cv_received_at);
                            // this.date_salary = this.formatDate(data.salary_signed_at);
                            // this.remark = data.note;
                            this.school_gra = data.school;
                            // this.dm_id = data.emp_demandid;
                            // this.dm_Subpos = data.sub_position;
                            this.tel = data.regTel;
                            this.address = data.regAddress;
                            this.sub_tel = data.commTel;
                            this.sub_address = data.commAddress;
                            this.nation = data.countryid;
                            // this.empno_hrm = data.newEmpno;
                            // this.parameters = data.tmp_idyclass;
                            // this.position = this.item_position.find(x => String(x.code) === String(data.tmp_dutyid));
                            this.dantoc = this.item_dantoc.find(x => String(x.code) === String(data.tmp_ca));
                            this.religious = this.item_religious.find(x => String(x.code) === String(data.religious));
                            // this.level = data.tmp_levelid;
                            // this.deputy = data.tmp_rankid;
                            // this.code_mc = data.tmp_siteid;
                            // this.loc_work = data.tmp_workareaid;
                            // this.direct = this.item_direct.find(x => String(x.code) === String(data.isdirect));
                            // this.nationality = data.national;
                            this.married = this.item_married.find(x => String(x.code) === String(data.marrage));
                            // this.birth_province = this.item_birth_province.find(x => String(x.code) === String(data.birth_province));
                            // this.province = this.item_province.find(x => String(x.code) === String(data.province));
                            this.edu = this.item_edu.find(x => String(x.code) === String(data.edu));
                            // this.time_trial = data.probation;
                            // this.bus_info = data.bus_info;
                            this.selectedDatecccd = this.formatDate(data.datecccd);
                            // this.reason = data.reason;
                            // this.change_date = this.formatDate(data.change_en_date);
                            this.work_exp = data.work_exp;
                            this.ex_company = data.ex_company;
                            this.ex_position = data.ex_position;
                        }
                    }
                    else {
                    }
                }
            } catch (error) {
                console.error('Error checking CCCD:', error);
                this.$notify({
                    title: 'Error',
                    text: 'Failed to check CCCD',
                    type: 'error'
                });
            }
        },
        
        formatDate(dateString) {
            if (!dateString) return '';
            // Convert DD/MM/YYYY to YYYY-MM-DD
            const parts = dateString.split('/');
            if (parts.length === 3) {
                return `${parts[2]}-${parts[1].padStart(2, '0')}-${parts[0].padStart(2, '0')}`;
            }
            return dateString;
        },
        
        async getAllSourceRecruiting() {
            try {
                const res = await this.$axios.get(this.api + 'getSourceRecruiting');
                if (res.status === 200) {
                    let _rData = res.data;
                    this.item_source_recruit = _rData.map((x) => {
                        let name, code;
                        try {
                            name = JSON.parse(x.source);
                        } catch (e) {
                            name = {
                                vi: x.source.vi,
                                en: x.source.en,
                                cn: x.source.cn
                            };
                        }
                        try {
                            code = JSON.parse(x.id);
                        } catch (e) {
                            code = x.id;
                        }
                        return {
                            code: code,
                            name: name,
                        };
                        
                    });
                    this.dataList = this.item_source_recruit;
                }
            } catch (error) {
                console.error('Error fetching source recruiting:', error);
            }
        },
        edit_recruit(data) {
            this.id = data.code;
            this.input_source.vi = data.name.vi;
            this.input_source.en = data.name.en;
            this.input_source.cn = data.name.cn;
        },
        focusNameField() {
            this.$refs.nameField.focus();
        },
        truncateText(text) {
            return text ? (text.length > 20 ? text.substring(0, 20) + '...' : text) : '';
        },
        showNoteDialog(item) {
            this.selectedNote = item.dem_note;
            this.noteDialog = true;
        },
        async saveSourceRecruiting() {
            if (!this.input_source.vi || !this.input_source.en || !this.input_source.cn) {
                this.$notify({
                    title: 'Error',
                    text: 'Please fill in all language fields',
                    type: 'error'
                });
                return;
            }
            
            let params = {
                id: this.id,
                source: {
                    vi: this.input_source.vi,
                    en: this.input_source.en,
                    cn: this.input_source.cn
                }
            };
            try {
                const res = await this.$axios.post(this.api + 'saveSourceRecruiting', params);
                if (res.status === 200) {
                    this.$notify({
                        title: 'Success',
                        text: this.id ? 'Source updated successfully' : 'New source added successfully',
                        type: 'success'
                    });
                    await this.getAllSourceRecruiting();
                    this.resetSourceForm();
                }
            } catch (error) {
                console.error('Error saving source:', error);
                this.$notify({
                    title: 'Error',
                    text: 'Failed to save source',
                    type: 'error'
                });
            }
        },
        resetSourceForm() {
            this.id = '';
            this.input_source = {
                vi: '',
                en: '',
                cn: ''
            };
        },
        validateName() {
            this.nameError = !this.name.trim() ? this.$t('Name is required') : '';
        },
        validateCccd(value) {
            // Remove any non-digit characters
            this.cccd = value.replace(/\D/g, '').substring(0, 12);
        },
        async getDataResign() {
            let params = {
                emp_id: this.cccd,
            };
            try {
                const response = await this.$axios.post(this.api + 'GetDataByCCCDResign', params);
                this.resignData = response.data;
                
            } catch (error) {
                console.error("Error fetching employee data:", error);
            } finally {
            }
        },
        showResignDialog() {
            if (this.resignData && Object.keys(this.resignData).length > 0) {
                this.resignDialog = true;
            } else {
                this.$notify({
                    title: 'Info ',
                    text: 'No resignation history found',
                    type: 'info'
                });
            }
        },
        getReasonText(reasonId) {
            const reason = this.reasons.find(r => r.id === reasonId);
            return reason ? reason.reason : '';
        },
        getReason(reason) {
            try {
                const foundReason = this.reasons.find(r => String(r.id) === String(reason));
                if (foundReason) {
                    const reasonObj = typeof foundReason.reason === 'string' ?
                    JSON.parse(foundReason.reason) :
                    foundReason.reason;
                    return reasonObj[this.$i18n.locale] || reasonObj['en'] || reason;
                }
                return reason;
            } catch (e) {
                return reason;
            }
        },
        async deleteData() {
            if (!this.id) {
                this.$notify({
                    title: 'Error',
                    text: 'No record selected for deletion',
                    type: 'error'
                });
                return;
            }
            this.confirmDialog = true;
        },
        async confirmDelete() {
            try {
                this.loading = true;
                this.confirmDialog = false;
                const res = await this.$axios.get(this.api + 'deleteDataById/' + this.id);
                if (res.status === 200) {
                    this.$notify({
                        title: 'Success',
                        text: 'Data deleted successfully',
                        type: 'success'
                    });
                    this.resetForm();
                    this.$router.push({ name: 'index' });
                }
            } catch (error) {
                console.error('Error deleting data:', error);
                this.$notify({
                    title: 'Error',
                    text: 'Failed to delete data',
                    type: 'error'
                });
            } finally {
                this.loading = false;
            }
        },
        showFullNote(note) {
            this.selectedFullNote = note;
            this.noteDialogFull = true;
        },
        updateDirectValue() {
            // Tìm department details từ raw data
            const deptDetails = this.allDepartments[this.dept_apply?.code]?.find(d =>
            d.code === this.newDept?.code
            );
            // Get position code 
            const positionCode = this.position?.code;
            // Tìm direct options
            const directD = this.item_direct.find(d => d.name === 'D');
            const directI = this.item_direct.find(d => d.name === 'I');
            
            // console.log('deptDetails:', deptDetails);
            // console.log('positionCode:', positionCode);
            // console.log('directD:', directD);
            // console.log('directI:', directI);
            
            // Set direct dựa trên điều kiện
            if (deptDetails?.fid === 'D' && positionCode === 'C02') {
                this.direct = directD;
            } else {
                this.direct = directI;
            }
        },
        updateTrialPeriod() {
            // For position C02, set to 6
            if (this.position?.code === 'C02') {
                this.time_trial = 6;
                return;
            }
            
            // For other positions, check education level
            if (this.edu?.code) {
                const eduCode = parseInt(this.edu.code);
                
                // For education codes 001-006
                if (eduCode >= 1 && eduCode <= 6) {
                    this.time_trial = 30;
                }
                // For education codes 007-010 
                else if (eduCode >= 7 && eduCode <= 10) {
                    this.time_trial = 60;
                }
            }
        }
    },
    mounted() {
        const sessionUser = this.$session.get("recruiting-report");
        if (sessionUser) {
            this.activeUser = {
                empno: sessionUser.empno,
                name: sessionUser.name,
                dept_sumt: sessionUser.dept,
                division: sessionUser.hight_dept,
                location: sessionUser.location,
                email: sessionUser.email,
            };
        }
        this.getReasons();
        this.getAllDuty();
        this.getAllNation();
        this.getAllReligious();
        this.getAllEdu();
        this.getAllProvince();
        this.getAllDirect();
        this.getAllMarried();
        this.getDeptCode();
        this.getAllSourceRecruiting();
        if (this.$route.query.id) {
            this.id = this.$route.query.id;
            this.getAllByQuery();
        }
        else {
        }
        this.$nextTick(() => {
            // Focus the name field when component is mounted
            this.focusNameField();
        });
    }
}
</script>
<style scoped>
/* Add these new styles at the top */
::-webkit-scrollbar {
    display: none;
}

* {
    -ms-overflow-style: none;
    /* IE and Edge */
    scrollbar-width: none;
    /* Firefox */
}

/* Existing styles */
.section-header {
    display: flex;
    align-items: center;
    margin-bottom: 16px;
}

.text-h6 {
    color: #1976d2;
    font-size: 1.1rem;
    font-weight: 500;
    letter-spacing: 0.5px;
}

.v-card {
    border-radius: 8px;
    transition: all 0.3s ease;
}

.v-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1) !important;
}

.v-text-field.v-text-field--outlined>>>.v-input__control {
    min-height: 40px;
}

.v-text-field.v-text-field--outlined>>>.v-input__slot {
    min-height: 40px;
}

.v-btn {
    text-transform: none;
    letter-spacing: 0.5px;
    font-weight: 500;
}

.v-btn:not(.v-btn--flat):not(.v-btn--text):not(.v-btn--outlined) {
    box-shadow: 0 3px 5px rgba(0, 0, 0, 0.1);
}

.v-dialog {
    border-radius: 8px;
    overflow: hidden;
}

.truncate-text {
    display: inline-block;
    max-width: 50x;
    white-space: nowrap;
    
    overflow: hidden;
    text-overflow: ellipsis;
}

.note-text {
    display: inline-block;
    max-width: 150px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    color: #1976d2;
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 4px;
    background-color: #e3f2fd;
}

.note-text:hover {
    background-color: #bbdefb;
}

.v-data-table>>>th {
    font-weight: bold !important;
    white-space: nowrap;
}

.v-data-table>>>td {
    white-space: normal;
    max-width: 300px;
    overflow: hidden;
    text-overflow: ellipsis;
}

.text-wrap {
    white-space: normal;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 200px;
}

.truncated-text {
    display: block;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    cursor: pointer;
    padding: 4px;
    border-radius: 4px;
    transition: background-color 0.2s;
}

.truncated-text:hover {
    background-color: rgba(0, 0, 0, 0.05);
}

.text-truncate {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.v-dialog .headline {
    font-size: 1.25rem;
    font-weight: 500;
    line-height: 2rem;
    letter-spacing: 0.0125em;
    padding: 16px;
}
</style>